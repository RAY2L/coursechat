<div class="container d-flex justify-content-center">
  <div class="card" style="width: 80%">
    <div class="card-header">
      <ul class="nav nav-tabs card-header-tabs">
        <li class="nav-item">
          <a class="nav-link active" data-bs-toggle="tab" href="#search_current"
            >Autumn 2023</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" data-bs-toggle="tab" href="#search_all"
            >All Quarters</a
          >
        </li>
      </ul>
    </div>
    <div class="card-body">
      <div class="tab-content">
        <div class="tab-pane active" id="search_current">
          <h5 class="card-title">Search Autumn 2023 courses</h5>
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              id="search-current-input"
              placeholder="..."
              autocomplete="off"
              aria-describedby="basic-addon2"
            />
            <button
              type="button"
              class="btn bg-transparent py-0 d-flex align-items-center"
              id="search-current-input-clear"
              style="margin-left: -40px; z-index: 100"
              onclick=""
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                class="bi bi-x-lg"
                viewBox="0 0 16 16"
              >
                <path
                  d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"
                />
              </svg>
            </button>
          </div>
        </div>
        <div class="tab-pane" id="search_all">
          <h5 class="card-title">Search all courses</h5>
          <div class="input-group">
            <div class="input-group">
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="search-all-input"
                  placeholder="..."
                  autocomplete="off"
                  aria-describedby="basic-addon2"
                />
                <button
                  type="button"
                  class="btn bg-transparent py-0 d-flex align-items-center"
                  id="search-all-input-clear"
                  style="margin-left: -40px; z-index: 100"
                  onclick=""
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    fill="currentColor"
                    class="bi bi-x-lg"
                    viewBox="0 0 16 16"
                  >
                    <path
                      d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"
                    />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const current_courses = <%- current_courses %>;
  const courses = <%- courses %>;
  const current_course_to_coursename = <%- current_course_to_coursename %>;
  const all_course_to_coursename = <%- all_course_to_coursename %>;
  // console.log(current_courses);
  // console.log(courses);

  $("#search-current-input")
    .typeahead({
      source: current_courses,
      autoSelect: true,
      displayText: function (item) {
        return `${item.name} - ${current_course_to_coursename[item.name]}`;
      },
      afterSelect: function (item) {
        window.location.href =
          "/" + item.value.subject + "/" + item.value.courseId;
      },
      items: 10,
    })
    .keypress(function (e) {
      if (e.which === 13) {
        const inputVal = $(this).val();
        const uniqueMatch = courses.filter(function (choice) {
          return choice.name.toLowerCase() === inputVal.toLowerCase();
        });
        if (uniqueMatch.length === 1) {
          const url = `/${uniqueMatch[0].value.subject}/${uniqueMatch[0].value.courseId}`;
          window.location.href = url;
        }
      }
    });

  $("#search-all-input")
    .typeahead({
      source: courses,
      autoSelect: true,
      displayText: function (item) {
          // $(".dropdown-item").css("word-wrap", "break-word");
          // $(".dropdown-item").css("white-space", "normal");
        return `${item.name} - ${all_course_to_coursename[item.name]}`;
      },
      afterSelect: function (item) {
        window.location.href =
          `/${item.value.subject}/${item.value.courseId}`;
      },
      items: 10,
    })
    .keypress(function (e) {
      if (e.which === 13) {
        const inputVal = $(this).val();
        const uniqueMatch = courses.filter(function (choice) {
          return choice.name.toLowerCase() === inputVal.toLowerCase();
        });
        if (uniqueMatch.length === 1) {
          const url = `/${uniqueMatch[0].value.subject}/${uniqueMatch[0].value.courseId}`;
          window.location.href = url;
        }
      }
    });

    $("#search-current-input-clear").click(() => {
      $("#search-current-input").val("");
    });

    $("#search-all-input-clear").click(() => {
      $("#search-all-input").val("");
    });
</script>
